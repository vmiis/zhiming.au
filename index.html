<!DOCTYPE html>
<html>
    <head>
        <meta name="description" content="">
        <meta name='viewport' content='width=device-width, initial-scale=1'>
        <meta charset="UTF-8">
        <link rel="icon" href="data:,">
        <script>$vm={}</script>
        <script src="vm.js"></script>
    </head>
    <body>
        <div class="parent">
            <div id="pp" style="overflow: auto;">
                <div id=a style="max-width:600px; margin:auto; padding:10px 0 8px 0; ">
                    <div id="home" style="padding-top:20px">
                        <div style="text-align: center;"><h2>Zhiming GPT</h2></div>
                        <div>I am Virtual Zhiming, a frontend AI. I am happy to answer your questions on behalf of backend Zhiming. 
                            My intelligence is highly dependent on the CPU/GPU, RAM, and training. 
                            Currently, I have very limited knowledge because the backend Zhiming has a very limited budget for my growth. 
                            This means that my answers may not always be correct. 
                            I am constantly learning and improving, and I hope to provide more accurate information in the future.</div>
                    </div>
                </div>
            </div>
            <div>
                <div style="max-width:600px; margin:auto;">
                    <input autocomplete="off" id=q style="padding-left:3px; border: 1px solid #fff; margin-right:6px; height:30px;width: calc(100% - 50px);display:inline-block"></input>
                    <svg id=s stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 mr-1" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                </div>
            </div>
        </div>
        <script>
            (()=>{
                $vm.api_address='https://api.zhiming.au';
                if(window.location.hostname=='127.0.0.1' || window.location.hostname=='localhost') $vm.api_address='http://localhost:8001';
                var query=function(){
                    var q=document.getElementById("q").value;
                    document.getElementById("a").insertAdjacentHTML('beforeend',"<div style='padding:8px 3px 0 6px;color:#999'>Q: "+q+"<div>");
                    
                    var req={cmd:'qna',q:q}
                    $vm.request(req).then((res)=>{
                        console.log(res);
                        console.log(parseFloat(res.score).toFixed(2)+"  |  "+res.source+"  |  "+res.question+"  |  "+res.answer);
                        var answer=res.answer;
                        if(res.score<2){
                            answer="Sorry, I am not confident to provide correct information.";
                            const chineseRegex = /[\u4e00-\u9fa5]/; 
                            if(chineseRegex.test(q))  answer="很抱歉，没有合适的信息。";
                        }
                        document.getElementById("a").insertAdjacentHTML('beforeend',"<div style='padding:6px 3px 0 6px; background:#111'>A: "+answer+"<div>");
                        document.getElementById("q").value='';
                        const myDiv = document.getElementById('pp');
                        myDiv.scrollTop = myDiv.scrollHeight;
                    })
                    .catch(err => {  
                        console.log(err);
                    });
                }
                q.addEventListener("keyup", function(e){ if (e.keyCode === 13) {  query();  }  })
                s.addEventListener('click',function(e){ query1(); })
                var query1=function(){
                    var req={cmd:'insert',table:"demo-contact",data:{"first":"aaa","last":"bbb"} }
                    $vm.request(req).then((res)=>{
                        console.log(res);
                    })
                }

            })();
        </script>
        <style>
            html,body,input,textarea{
                margin:0;
                padding:0;
                height:100%;
                width:100%;
                background-color: #222;
                color:#fff;
            }
            #a div{
                padding:3px 0;
            }
            .parent {
                font-family: sans-serif;
                height:calc(100% - 20px);
                display: grid;
                grid-template-columns: 1fr;
                grid-template-rows: 1fr 30px;
                grid-column-gap: 0px;
                grid-row-gap: 0px;
                padding:10px;
            }
        </style>
    </body>
</html>
