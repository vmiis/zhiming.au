<!DOCTYPE html>
<html>
    <head>
        <meta name="description" content="">
        <meta name='viewport' content='width=device-width, initial-scale=1'>
        <meta charset="UTF-8">
        <link rel="icon" href="data:,">
        <script src="https://ajax.aspnetcdn.com/ajax/jquery/jquery-3.5.1.min.js"></script>
    </head>
    <body>
        <div class="parent">
            <div id="pp" style="overflow: auto;">
                <div id=a style="max-width:600px; margin:auto; padding:10px 0 8px 0; ">
                    <div id="home" style="padding-top:20px">
                        <div style="text-align: center;"><h2>Zhiming GPT</h2></div>
                        <div>I am Virtual Zhiming (frontend silicon-based) and happy to answer your questions on behalf of Zhiming (backend carbon-based). 
                            My intelegenc is highly depend on the vCPU and RAM as well as the training. Currently I have very limited knowledge because the backend Zhiming has a very limited budget, so the answers may not be correct.  
                            I keep learning and improving and hope I can provide more accurate information.</div>
                    </div>
                </div>
            </div>
            <div>
                <div style="max-width:600px; margin:auto;">
                    <input autocomplete="off" id=q style="padding-left:3px; border: 1px solid #fff; margin-right:6px; height:30px;width: calc(100% - 50px);display:inline-block"></input>
                    <svg id=s stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 mr-1" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                </div>
            </div>
        </div>
        <script>
            (()=>{
                var server='https://05.vmiis.com';
                if(window.location.hostname=='127.0.0.1' || window.location.hostname=='localhost') server='http://localhost:8001';

                var query=function(){
                    var q=$('#q').val();
                    $('#a').append("<div style='padding:8px 3px 0 6px;color:#999'>Q: "+q+"<div>"); 
                    var data={cmd:'qna',q:q}
                    fetch(server,{
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)                        
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log(parseFloat(data.score).toFixed(2)+"  |  "+data.source+"  |  "+data.question+"  |  "+data.answer);
                        var answer=data.answer;
                        if(data.score<2){
                            answer="Sorry, I am not confident to provide correct information.";
                            const chineseRegex = /[\u4e00-\u9fa5]/; 
                            if(chineseRegex.test(q))  answer="很抱歉，没有合适的信息。";
                        }
                        $('#a').append("<div style='padding:6px 3px 0 6px; background:#111'>A: "+answer+"<div>");
                        $('#q').val('');
                        const myDiv = document.getElementById('pp');
                        myDiv.scrollTop = myDiv.scrollHeight;
                    })
                    .catch(error => {
                        console.error(error);
                    });
                }
                q.addEventListener("keyup", function(event) {
                    if (event.keyCode === 13) {
                        query();
                    }
                })
                $('#s').on('click',function(){
                    query();
                })
            })();
        </script>
        <style>
            html,body,input,textarea{
                margin:0;
                padding:0;
                height:100%;
                width:100%;
                background-color: #222;
                color:#fff;
            }
            #a div{
                padding:3px 0;
            }
            .parent {
                font-family: sans-serif;
                height:calc(100% - 20px);
                display: grid;
                grid-template-columns: 1fr;
                grid-template-rows: 1fr 30px;
                grid-column-gap: 0px;
                grid-row-gap: 0px;
                padding:10px;
            }
        </style>
    </body>
</html>
